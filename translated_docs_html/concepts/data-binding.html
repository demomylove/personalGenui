<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Binding - A2UI 文档</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; line-height: 1.6; padding: 20px; max-width: 800px; margin: 0 auto; color: #24292e; }
        h1, h2, h3 { color: #24292e; margin-top: 24px; margin-bottom: 16px; }
        h1 { border-bottom: 1px solid #eaecef; padding-bottom: 0.3em; }
        h2 { border-bottom: 1px solid #eaecef; padding-bottom: 0.3em; }
        code { background-color: #f6f8fa; padding: 0.2em 0.4em; border-radius: 3px; font-family: SFMono-Regular, Consolas, "Liberation Mono", Menlo, monospace; font-size: 85%; }
        pre { background-color: #f6f8fa; padding: 16px; border-radius: 6px; overflow-x: auto; line-height: 1.45; }
        pre code { background-color: transparent; padding: 0; font-size: 100%; }
        a { color: #0366d6; text-decoration: none; }
        a:hover { text-decoration: underline; }
        ul { padding-left: 2em; }
        li { margin-top: 0.25em; }
        table { border-collapse: collapse; margin-bottom: 1em; width: 100%; }
        th, td { border: 1px solid #dfe2e5; padding: 0.6em 1em; }
        th { background-color: #f6f8fa; font-weight: 600; }
    </style>
</head>
<body>

<h1>数据绑定 (Data Binding)</h1>

<p>数据绑定使用 JSON Pointer 路径 (<a href="https://tools.ietf.org/html/rfc6901">RFC 6901</a>) 将 UI 组件连接到应用程序状态。这使得 A2UI 能够有效地为大型数组定义布局，或显示更新的内容而无需从头重新生成。</p>

<h2>结构 vs. 状态</h2>

<p>A2UI 分离了：</p>

<ol>
<li><strong>UI 结构</strong> (组件): 界面看起来是什么样的</li>
<li><strong>应用程序状态</strong> (数据模型): 它显示什么数据</li>
</ol>

<p>这实现了：响应式更新、数据驱动的 UI、可重用的模板和双向绑定。</p>

<h2>数据模型</h2>

<p>每个 surface 都有一个保存状态的 JSON 对象：</p>

<pre><code class="language-json">{
  "user": {"name": "Alice", "email": "alice@example.com"},
  "cart": {
    "items": [{"name": "Widget", "price": 9.99, "quantity": 2}],
    "total": 19.98
  }
}
</code></pre>

<h2>JSON Pointer 路径</h2>

<p><strong>语法：</strong></p>

<ul>
<li><code>/user/name</code> - 对象属性</li>
<li><code>/cart/items/0</code> - 数组索引（从零开始）</li>
<li><code>/cart/items/0/price</code> - 嵌套路径</li>
</ul>

<p><strong>示例：</strong></p>

<pre><code class="language-json">{"user": {"name": "Alice"}, "items": ["Apple", "Banana"]}
</code></pre>

<ul>
<li><code>/user/name</code> → <code>"Alice"</code></li>
<li><code>/items/0</code> → <code>"Apple"</code></li>
</ul>

<h2>字面量 vs. 路径值</h2>

<p><strong>Literal (固定):</strong></p>
<pre><code class="language-json">{"id": "title", "component": {"Text": {"text": {"literalString": "Welcome"}}}}
</code></pre>

<p><strong>Data-bound (响应式):</strong></p>
<pre><code class="language-json">{"id": "username", "component": {"Text": {"text": {"path": "/user/name"}}}}
</code></pre>

<p>当 <code>/user/name</code> 从 "Alice" 变为 "Bob" 时，文本 <strong>自动更新</strong> 为 "Bob"。</p>

<h2>响应式更新</h2>

<p>绑定到数据路径的组件在数据更改时会自动更新：</p>

<pre><code class="language-json">{"id": "status", "component": {"Text": {"text": {"path": "/order/status"}}}}
</code></pre>

<p><strong>Initial:</strong> <code>/order/status</code> = "Processing..." → 显示 "Processing..."<br>
<strong>Update:</strong> 发送 <code>dataModelUpdate</code> 包含 <code>status: "Shipped"</code> → 显示 "Shipped"</p>

<p>无需组件更新——只需数据更新。</p>

<h2>动态列表</h2>

<p>使用模板来渲染数组：</p>

<pre><code class="language-json">{
  "id": "product-list",
  "component": {
    "Column": {
      "children": {"template": {"dataBinding": "/products", "componentId": "product-card"}}
    }
  }
}
</code></pre>

<p><strong>Data:</strong></p>
<pre><code class="language-json">{"products": [{"name": "Widget", "price": 9.99}, {"name": "Gadget", "price": 19.99}]}
</code></pre>

<p><strong>Result:</strong> 渲染两张卡片，每个产品一张。</p>

<h3>作用域路径</h3>

<p>在模板内部，路径的作用域限定为数组项：</p>

<pre><code class="language-json">{"id": "product-name", "component": {"Text": {"text": {"path": "/name"}}}}
</code></pre>

<p>对于 <code>/products/0</code>，<code>/name</code> 解析为 <code>/products/0/name</code> → "Widget"<br>
对于 <code>/products/1</code>，<code>/name</code> 解析为 <code>/products/1/name</code> → "Gadget"</p>

<p>添加/移除项目会自动更新渲染的组件。</p>

<h2>输入绑定</h2>

<p>交互式组件双向更新数据模型：</p>

<table>
<thead>
<tr>
<th>组件</th>
<th>示例</th>
<th>用户操作</th>
<th>数据更新</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>TextField</strong></td>
<td><code>{"text": {"path": "/form/name"}}</code></td>
<td>输入 "Alice"</td>
<td><code>/form/name</code> = "Alice"</td>
</tr>
<tr>
<td><strong>CheckBox</strong></td>
<td><code>{"value": {"path": "/form/agreed"}}</code></td>
<td>勾选框</td>
<td><code>/form/agreed</code> = true</td>
</tr>
<tr>
<td><strong>MultipleChoice</strong></td>
<td><code>{"selections": {"path": "/form/country"}}</code></td>
<td>选择 "Canada"</td>
<td><code>/form/country</code> = ["ca"]</td>
</tr>
</tbody>
</table>

<h2>最佳实践</h2>

<p><strong>1. 使用细粒度更新</strong> - 仅更新更改的路径：</p>
<pre><code class="language-json">{"dataModelUpdate": {"path": "/user", "contents": [{"key": "name", "valueString": "Alice"}]}}
</code></pre>

<p><strong>2. 按领域组织</strong> - 对相关数据进行分组：</p>
<pre><code class="language-json">{"user": {...}, "cart": {...}, "ui": {...}}
</code></pre>

<p><strong>3. 预计算显示值</strong> - 代理在发送前格式化数据（货币、日期）：</p>
<pre><code class="language-json">{"price": "$19.99"}  // 而不是: {"price": 19.99}
</code></pre>

</body>
</html>
