<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IC_NM_GenUIKit é¡¹ç›®æ¶æ„è§£æ</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <style>
        :root {
            --primary-color: #0066cc;
            --bg-color: #f9f9f9;
            --text-color: #333;
            --code-bg: #f5f5f5;
            --card-bg: #ffffff;
            --border-color: #eaeaea;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            line-height: 1.6;
            color: var(--text-color);
            background-color: var(--bg-color);
            margin: 0;
            padding: 40px;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: var(--card-bg);
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.05);
        }
        h1 {
            border-bottom: 2px solid var(--border-color);
            padding-bottom: 20px;
            margin-bottom: 30px;
            color: #1a1a1a;
        }
        h2 {
            color: var(--primary-color);
            margin-top: 40px;
            margin-bottom: 20px;
            border-left: 4px solid var(--primary-color);
            padding-left: 12px;
        }
        h3 {
            color: #444;
            margin-top: 25px;
        }
        ul, ol {
            padding-left: 24px;
        }
        li {
            margin-bottom: 8px;
        }
        code {
            background-color: var(--code-bg);
            padding: 2px 6px;
            border-radius: 4px;
            font-family: SFMono-Regular, Consolas, "Liberation Mono", Menlo, monospace;
            font-size: 0.9em;
            color: #d63384;
        }
        pre {
            background-color: #2d2d2d;
            color: #f8f8f2;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 20px 0;
        }
        .mermaid {
            background: white;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #eee;
            margin: 20px 0;
            overflow-x: auto;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        th, td {
            border: 1px solid #e0e0e0;
            padding: 12px;
            text-align: left;
        }
        th {
            background-color: #f5f7fa;
            width: 25%;
        }
        .note {
            background-color: #e6f3ff;
            border-left: 4px solid #0066cc;
            padding: 15px;
            border-radius: 0 4px 4px 0;
            margin: 20px 0;
        }
    </style>
</head>
<body>

<div class="container">
    <h1>IC_NM_GenUIKit é¡¹ç›®æ¶æ„è§£æ</h1>
    <p>æœ¬æ–‡æ¡£æ—¨åœ¨æ€»ç»“æœ¬é¡¹ç›® (React Native ç«¯) çš„æ ¸å¿ƒæ¶æ„ã€ç›®å½•ç»“æ„ã€å…³é”®æ¨¡å—åŠå…¶äº¤äº’æµç¨‹ï¼Œç‰¹åˆ«èšç„¦äº A2UI åè®®çš„æµå¼ç”Ÿæˆæœºåˆ¶ã€‚</p>

    <h2>ä¸€ã€é¡¹ç›®æ ¸å¿ƒç†å¿µ</h2>
    <div class="note">
        <strong>State-Driven UI (çŠ¶æ€é©±åŠ¨ç•Œé¢)</strong><br>
        æœ¬é¡¹ç›®æŠ›å¼ƒäº†ä¼ ç»Ÿçš„å‘½ä»¤å¼ UI å¼€å‘æ¨¡å¼ã€‚ç•Œé¢ä¸æ˜¯ç”»å‡ºæ¥çš„ï¼Œè€Œæ˜¯â€œç®—â€å‡ºæ¥çš„ã€‚<br>
        <code>UI = f(State)</code><br>
        å®¢æˆ·ç«¯ä¸ä»…æ˜¯ä¸€ä¸ªæ˜¾ç¤ºå™¨ï¼Œæ›´æ˜¯ä¸€ä¸ªæ¸²æŸ“å¼•æ“ã€‚å®ƒæ¥æ”¶æœåŠ¡ç«¯æ¨é€çš„ DSL (Domain Specific Language) æ•°æ®ï¼ŒåŠ¨æ€ç”ŸæˆåŸç”Ÿç»„ä»¶æ ‘ã€‚
    </div>

    <h2>äºŒã€ç›®å½•ç»“æ„è§£æ</h2>
    <table>
        <thead>
            <tr>
                <th>è·¯å¾„</th>
                <th>è¯´æ˜</th>
                <th>å…³é”®æ–‡ä»¶</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td><code>src/screens/</code></td>
                <td><strong>UI å…¥å£å±‚</strong><br>åŒ…å«åº”ç”¨çš„ä¸»è¦é¡µé¢ç»„ä»¶ã€‚</td>
                <td>
                    <ul>
                        <li><code>MainScreen.tsx</code>: åº”ç”¨ä¸»æ§åˆ¶å™¨ã€‚è´Ÿè´£çŠ¶æ€ç®¡ç†ã€ç½‘ç»œè¯·æ±‚å‘èµ·ã€æ¶ˆæ¯åˆ—è¡¨æ¸²æŸ“ã€‚</li>
                        <li><code>ChatScreen.tsx</code>: (å¤‡ç”¨/æµ‹è¯•) å¦ä¸€ä¸ªèŠå¤©ç•Œé¢å®ç°ã€‚</li>
                    </ul>
                </td>
            </tr>
            <tr>
                <td><code>src/utils/</code></td>
                <td><strong>é€šä¿¡å±‚ & å·¥å…·å±‚</strong><br>è´Ÿè´£ä¸æœåŠ¡ç«¯äº¤äº’çš„æ ¸å¿ƒé€»è¾‘ã€‚</td>
                <td>
                    <ul>
                        <li><code>AGUIClient.ts</code>: <strong>æ ¸å¿ƒé€šä¿¡æ¨¡å—</strong>ã€‚å°è£…äº† SSE é•¿è¿æ¥ã€JSON Patch åˆå¹¶ç®—æ³•ã€äº‹ä»¶åˆ†å‘ã€‚</li>
                    </ul>
                </td>
            </tr>
            <tr>
                <td><code>src/dsl/</code></td>
                <td><strong>æ¸²æŸ“å¼•æ“å±‚</strong><br>è´Ÿè´£å°† JSON DSL è½¬æ¢ä¸º React ç»„ä»¶ã€‚</td>
                <td>
                    <ul>
                        <li><code>DslRenderer.tsx</code>: <strong>é€’å½’æ¸²æŸ“å™¨</strong>ã€‚<code>renderComponent</code> å‡½æ•°æ‰€åœ¨åœ°ï¼Œè´Ÿè´£éå† DSL æ ‘ã€‚</li>
                        <li><code>WidgetMapper.tsx</code>: <strong>ç»„ä»¶æ˜ å°„è¡¨</strong>ã€‚å®šä¹‰äº† <code>type: "button"</code> å¯¹åº”å“ªä¸ª RN åŸç”Ÿç»„ä»¶ã€‚</li>
                    </ul>
                </td>
            </tr>
            <tr>
                <td><code>src/components/</code></td>
                <td><strong>åŸå­ç»„ä»¶åº“</strong><br>æ„æˆç•Œé¢çš„åŸºç¡€ç§¯æœ¨ã€‚</td>
                <td>
                    <ul>
                        <li><code>TaskCard.tsx</code>ã€<code>VoiceInput.tsx</code>: ä¸šåŠ¡ç›¸å…³å¤ç”¨ç»„ä»¶ã€‚</li>
                        <li><code>IntentionBlurView.tsx</code>: è§†è§‰æ•ˆæœç»„ä»¶ã€‚</li>
                    </ul>
                </td>
            </tr>
        </tbody>
    </table>

    <h2>ä¸‰ã€æ ¸å¿ƒæ•°æ®æµå‘ (Data Flow)</h2>
    <p>ä¸‹å›¾å±•ç¤ºäº†ä»ç”¨æˆ·å‘èµ·è¯·æ±‚ï¼Œåˆ°æœåŠ¡ç«¯æµå¼å“åº”ï¼Œå†åˆ°å®¢æˆ·ç«¯åŠ¨æ€æ¸²æŸ“çš„å®Œæ•´é—­ç¯ã€‚</p>

    <div class="mermaid">
sequenceDiagram
    participant User as ğŸ‘¤ User
    participant Main as ğŸ“± MainScreen (Store)
    participant Client as ğŸ”Œ AGUIClient (Net)
    participant Renderer as ğŸ¨ DslRenderer
    participant Server as â˜ï¸ Cloud (A2UI)

    Note over User, Server: é˜¶æ®µä¸€ï¼šå‘èµ·äº¤äº’
    User->>Main: 1. è¯­éŸ³/æ–‡æœ¬è¾“å…¥
    Main->>Main: setStatus('thinking')
    Main->>Client: 2. sendMessage(prompt)
    Client->>Server: HTTP POST (SSE Connect)

    Note over User, Server: é˜¶æ®µäºŒï¼šæµå¼æ¥æ”¶ä¸çŠ¶æ€åˆå¹¶
    loop Infinite Stream (Thinking & Generating)
        Server-->>Client: 3. Event: STATE_DELTA (Patch)
        Client->>Client: apply_patch(oldState, patch) -> newState
        Client->>Main: 4. onStateUpdate(newState)
    end

    Note over User, Server: é˜¶æ®µä¸‰ï¼šçŠ¶æ€é©±åŠ¨é‡ç»˜
    rect rgb(240, 248, 255)
        Note right of Main: The React Render Cycle
        Main->>Main: 5. setAgentState(newState) [è§¦å‘é‡ç»˜]
        Main-->>Renderer: 6. renderComponent(newState.dsl) [å¼€å§‹é€’å½’]
        Renderer-->>Renderer: é€’å½’éå† DSL JSON æ ‘
        Renderer-->>Main: è¿”å› React Element Tree
        Main-->>User: 7. å±å¹•ç•Œé¢åˆ·æ–° (Native Views Update)
    end
    </div>

    <h2>å››ã€å…³é”®æŠ€æœ¯ç‚¹åˆ†æ</h2>

    <h3>4.1 AGUIClient (é€šä¿¡ä¸­æ¢)</h3>
    <p>å®ƒä¸åªæ˜¯ä¸€ä¸ª HTTP å®¢æˆ·ç«¯ï¼Œå®ƒæ˜¯ä¸€ä¸ª<strong>çŠ¶æ€æœºåŒæ­¥å™¨</strong>ã€‚</p>
    <ul>
        <li><strong>é•¿è¿æ¥</strong>ï¼šä½¿ç”¨ Server-Sent Events (SSE) åè®®ï¼Œå…è®¸æœåŠ¡ç«¯å•å‘æŒç»­æ¨é€æ•°æ®ã€‚</li>
        <li><strong>å¢é‡æ›´æ–°</strong>ï¼šæœåŠ¡ç«¯å‘é€çš„æ˜¯ JSON Patch (RFC 6902)ï¼Œè¿™å¤§å¤§å‡å°‘äº†ç½‘ç»œæµé‡ã€‚<code>AGUIClient</code> è´Ÿè´£æŠŠè¿™äº›ç¢ç‰‡æ‹¼æˆå®Œæ•´çš„ JSON å¯¹è±¡ã€‚</li>
    </ul>

    <h3>4.2 MainScreen (çŠ¶æ€å¤§è„‘)</h3>
    <p>å®ƒæ˜¯æ•´ä¸ªåº”ç”¨çš„<strong>å•ä¸€æ•°æ®æº (Single Source of Truth)</strong>ã€‚</p>
    <ul>
        <li><code>agentState</code>ï¼šè¿™ä¸ªå˜é‡å­˜å‚¨äº†æœåŠ¡ç«¯ä¸‹å‘çš„æ‰€æœ‰ä¿¡æ¯ï¼ˆå½“å‰ DSL ç»“æ„ã€æ•°æ®ä¸Šä¸‹æ–‡ç­‰ï¼‰ã€‚</li>
        <li><strong>ç”Ÿå‘½å‘¨æœŸç®¡ç†</strong>ï¼šå®ƒæ§åˆ¶äº†ä» <code>thinking</code> (æ€è€ƒä¸­) -> <code>drawing</code> (ç»˜åˆ¶ä¸­) -> <code>completed</code> (å®Œæˆ) çš„å…¨è¿‡ç¨‹ã€‚</li>
    </ul>

    <h3>4.3 DslRenderer (ç”Ÿæˆå¼•æ“)</h3>
    <p>å®ƒæ˜¯è¿æ¥â€œæ•°æ®â€ä¸â€œUIâ€çš„æ¡¥æ¢ã€‚</p>
    <ul>
        <li><strong>é€’å½’é€»è¾‘</strong>ï¼šé€šè¿‡æ·±åº¦ä¼˜å…ˆéå† (DFS) ç®—æ³•ï¼ŒæŠŠåµŒå¥—çš„ JSON æ ‘è½¬åŒ–ä¸ºåµŒå¥—çš„ React ç»„ä»¶æ ‘ã€‚</li>
        <li><strong>åŠ¨æ€æ€§</strong>ï¼šå®ƒä¸å­˜åœ¨ä»»ä½•ç¡¬ç¼–ç çš„ä¸šåŠ¡é€»è¾‘ã€‚å®ƒåªè®¤è¯† DSL è§„èŒƒï¼ˆå¦‚ <code>Column</code>, <code>Text</code>ï¼‰ï¼Œè¿™ä½¿å¾—æœåŠ¡ç«¯å¯ä»¥ä¸‹å‘ä»»ä½•å…¨æ–°çš„ç•Œé¢è€Œæ— éœ€å®¢æˆ·ç«¯å‘ç‰ˆã€‚</li>
    </ul>

    <h2>äº”ã€å½“å‰æ¶æ„çš„ä¼˜åŠ£åŠ¿</h2>
    
    <h3>ä¼˜åŠ¿ âœ…</h3>
    <ul>
        <li><strong>æè‡´çµæ´»</strong>ï¼šServer ç«¯æ”¹ä¸€è¡Œ JSONï¼ŒClient ç«¯ç•Œé¢ç«‹åˆ»å˜ï¼Œæ— éœ€å®¡æ ¸å‘ç‰ˆ (OTA)ã€‚</li>
        <li><strong>å¤šç«¯ç»Ÿä¸€</strong>ï¼šå¦‚æœæ˜¯æ ‡å‡† A2UI åè®®ï¼ŒåŒä¸€å¥— DSL å¯ä»¥åŒæ—¶æ¸²æŸ“åœ¨ iOS, Android, Web ä¸Šã€‚</li>
        <li><strong>å¼€å‘è§£è€¦</strong>ï¼šå‰ç«¯åªè´Ÿè´£å¼€å‘åŸå­ç»„ä»¶ï¼ˆç§¯æœ¨å—ï¼‰ï¼Œåç«¯è´Ÿè´£æ­å»ºé¡µé¢ï¼ˆæ­ç§¯æœ¨ï¼‰ã€‚</li>
    </ul>

    <h3>æŒ‘æˆ˜ âš ï¸</h3>
    <ul>
        <li><strong>æ€§èƒ½ç“¶é¢ˆ</strong>ï¼šç›®å‰çš„â€œå…¨é‡çŠ¶æ€æ›¿æ¢ + å…¨é‡é€’å½’é‡ç»˜â€æœºåˆ¶ï¼Œåœ¨èŠ‚ç‚¹æ•°æ¿€å¢ï¼ˆ>500ï¼‰æ—¶ä¼šé˜»å¡ JS çº¿ç¨‹ï¼Œå¯¼è‡´æ‰å¸§ã€‚</li>
        <li><strong>äº¤äº’å»¶è¿Ÿ</strong>ï¼šç‚¹å‡»äº‹ä»¶éœ€è·¨è¶Š Bridge åˆ° JS å†åˆ° Nativeï¼Œé“¾è·¯è¾ƒé•¿ã€‚</li>
        <li><strong>ä½“éªŒæ‰“ç£¨</strong>ï¼šæµå¼ç”Ÿæˆçš„è§†è§‰æ•ˆæœï¼ˆå¦‚ Loading æ€ã€ç”Ÿé•¿åŠ¨ç”»ï¼‰å¾ˆå¤§ç¨‹åº¦ä¸Šä¾èµ–äºæœåŠ¡ç«¯æ¨é€çš„èŠ‚å¥æ§åˆ¶å’Œå®¢æˆ·ç«¯çš„å¹³æ»‘å¤„ç†ã€‚</li>
    </ul>

    <script>
        mermaid.initialize({ startOnLoad: true });
    </script>
</div>

</body>
</html>
