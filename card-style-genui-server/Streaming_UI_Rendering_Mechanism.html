<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æµå¼UIæ¸²æŸ“æœºåˆ¶è¯´æ˜</title>
    <style>
        :root {
            --primary: #4285f4;
            --success: #0f9d58;
            --warning: #f4b400;
            --danger: #db4437;
            --bg: #f8f9fa;
            --card-bg: #ffffff;
            --text: #202124;
            --text-secondary: #5f6368;
            --border: #dadce0;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Google Sans', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.6;
            padding: 40px 20px;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
        }
        
        h1 {
            font-size: 2rem;
            font-weight: 500;
            margin-bottom: 8px;
            color: var(--primary);
        }
        
        .subtitle {
            color: var(--text-secondary);
            margin-bottom: 32px;
            font-size: 1.1rem;
        }
        
        .question-card {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1), 0 1px 2px rgba(0,0,0,0.06);
            border-left: 4px solid var(--primary);
        }
        
        .question-card h2 {
            font-size: 1.25rem;
            font-weight: 500;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .question-number {
            background: var(--primary);
            color: white;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9rem;
            font-weight: 600;
        }
        
        .answer {
            background: #f1f3f4;
            border-radius: 8px;
            padding: 16px;
            margin-top: 12px;
        }
        
        .answer-label {
            font-weight: 600;
            color: var(--success);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .answer-label::before {
            content: "âœ“";
            background: var(--success);
            color: white;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
        }
        
        .code-block {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 16px;
            border-radius: 8px;
            font-family: 'Fira Code', 'Consolas', monospace;
            font-size: 0.85rem;
            overflow-x: auto;
            margin: 12px 0;
        }
        
        .code-block .keyword { color: #569cd6; }
        .code-block .string { color: #ce9178; }
        .code-block .comment { color: #6a9955; }
        .code-block .function { color: #dcdcaa; }
        
        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin: 16px 0;
        }
        
        .comparison-table th,
        .comparison-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }
        
        .comparison-table th {
            background: #f1f3f4;
            font-weight: 500;
        }
        
        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 16px;
            font-size: 0.8rem;
            font-weight: 500;
        }
        
        .badge-yes { background: #e6f4ea; color: var(--success); }
        .badge-no { background: #fce8e6; color: var(--danger); }
        .badge-partial { background: #fef7e0; color: #b06000; }
        
        .diagram {
            background: white;
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 20px;
            margin: 16px 0;
            text-align: center;
        }
        
        .diagram svg {
            max-width: 100%;
        }
        
        .summary-box {
            background: linear-gradient(135deg, #4285f4 0%, #34a853 100%);
            color: white;
            border-radius: 12px;
            padding: 24px;
            margin-top: 32px;
        }
        
        .summary-box h3 {
            font-size: 1.25rem;
            margin-bottom: 16px;
        }
        
        .summary-box ul {
            list-style: none;
            padding: 0;
        }
        
        .summary-box li {
            padding: 8px 0;
            padding-left: 28px;
            position: relative;
        }
        
        .summary-box li::before {
            content: "â†’";
            position: absolute;
            left: 0;
            font-weight: bold;
        }

        .flow-diagram {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            flex-wrap: wrap;
            margin: 16px 0;
        }
        
        .flow-step {
            background: var(--primary);
            color: white;
            padding: 12px 16px;
            border-radius: 8px;
            font-size: 0.9rem;
            text-align: center;
        }
        
        .flow-arrow {
            color: var(--text-secondary);
            font-size: 1.5rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¨ æµå¼UIæ¸²æŸ“æœºåˆ¶è¯´æ˜</h1>
        <p class="subtitle">GenUI Streaming UI Rendering Mechanism - 2026-01-07</p>

        <!-- Question 1 -->
        <div class="question-card">
            <h2>
                <span class="question-number">1</span>
                æ˜¯å¦è¿˜æ˜¯åµŒå¥—çš„ ViewTree æ•°æ®ç»“æ„ï¼Ÿ
            </h2>
            <div class="answer">
                <div class="answer-label">æ˜¯çš„ï¼Œä»ç„¶æ˜¯åµŒå¥—æ ‘ç»“æ„</div>
                <p>å½“å‰çš„ DSL ç»“æ„é‡‡ç”¨ <strong>åµŒå¥—æ ‘ (Nested Tree)</strong> å½¢å¼ï¼Œä½¿ç”¨ <code>children</code> æ•°ç»„è¡¨ç¤ºçˆ¶å­å…³ç³»ï¼š</p>
                <div class="code-block">
<span class="comment">// å½“å‰ DSL ç»“æ„ç¤ºä¾‹</span>
{
  <span class="string">"component_type"</span>: <span class="string">"Center"</span>,
  <span class="string">"properties"</span>: { <span class="string">"background_color"</span>: <span class="string">"#FFFFFF"</span> },
  <span class="string">"children"</span>: [
    {
      <span class="string">"component_type"</span>: <span class="string">"Card"</span>,
      <span class="string">"children"</span>: [
        { <span class="string">"component_type"</span>: <span class="string">"Text"</span>, <span class="string">"properties"</span>: { <span class="string">"text"</span>: <span class="string">"ä¸Šæµ·å¸‚"</span> } }
      ]
    }
  ]
}
                </div>
                <p><strong>å¯¹æ¯” A2UI åè®®çš„é‚»æ¥è¡¨ç»“æ„ï¼š</strong></p>
                <div class="code-block">
<span class="comment">// A2UI é‚»æ¥è¡¨ç»“æ„ç¤ºä¾‹</span>
{
  <span class="string">"components"</span>: [
    { <span class="string">"id"</span>: <span class="string">"root"</span>, <span class="string">"componentProperties"</span>: { <span class="string">"Column"</span>: { <span class="string">"children"</span>: { <span class="string">"explicitList"</span>: [<span class="string">"card1"</span>] } } } },
    { <span class="string">"id"</span>: <span class="string">"card1"</span>, <span class="string">"componentProperties"</span>: { <span class="string">"Card"</span>: { <span class="string">"child"</span>: <span class="string">"text1"</span> } } },
    { <span class="string">"id"</span>: <span class="string">"text1"</span>, <span class="string">"componentProperties"</span>: { <span class="string">"Text"</span>: { <span class="string">"text"</span>: <span class="string">"ä¸Šæµ·å¸‚"</span> } } }
  ]
}
                </div>
            </div>
        </div>

        <!-- Question 2 -->
        <div class="question-card">
            <h2>
                <span class="question-number">2</span>
                æ¯æ¬¡æ›´æ–°æ˜¯å¦éœ€è¦é‡æ–°ç»˜åˆ¶æ•´ä¸ª DSL / ViewTreeï¼Ÿ
            </h2>
            <div class="answer">
                <div class="answer-label">ä¸éœ€è¦ï¼å·²ä¼˜åŒ–ä¸ºå¢é‡æ›´æ–°</div>
                <p>é€šè¿‡ <strong>Phase 3 ä¼˜åŒ–</strong>ï¼Œæˆ‘ä»¬å®ç°äº†é«˜æ•ˆçš„å¢é‡æ¸²æŸ“ï¼š</p>
                
                <div class="flow-diagram">
                    <div class="flow-step">STATE_DELTA äº‹ä»¶</div>
                    <span class="flow-arrow">â†’</span>
                    <div class="flow-step">Immutable Patching</div>
                    <span class="flow-arrow">â†’</span>
                    <div class="flow-step">React.memo è·³è¿‡æœªå˜èŠ‚ç‚¹</div>
                    <span class="flow-arrow">â†’</span>
                    <div class="flow-step">ä»…é‡ç»˜å˜åŒ–éƒ¨åˆ†</div>
                </div>

                <h4 style="margin-top: 16px;">å…³é”®ä¼˜åŒ–ç‚¹ï¼š</h4>
                <table class="comparison-table">
                    <tr>
                        <th>ç»„ä»¶/æ–‡ä»¶</th>
                        <th>ä¼˜åŒ–æœºåˆ¶</th>
                        <th>æ•ˆæœ</th>
                    </tr>
                    <tr>
                        <td><code>DslRenderer.tsx</code></td>
                        <td><code>React.memo(DslNode)</code></td>
                        <td>Props æœªå˜æ—¶è·³è¿‡é‡æ¸²æŸ“</td>
                    </tr>
                    <tr>
                        <td><code>AGUIClient.ts</code></td>
                        <td><code>applyImmutablePatch()</code></td>
                        <td>Copy-on-Write ä¿è¯ç»“æ„å…±äº«</td>
                    </tr>
                    <tr>
                        <td><code>chat.ts</code></td>
                        <td><code>fast-json-patch.compare()</code></td>
                        <td>ä»…å‘é€å·®å¼‚è¡¥ä¸</td>
                    </tr>
                </table>
            </div>
        </div>

        <!-- Question 3 -->
        <div class="question-card">
            <h2>
                <span class="question-number">3</span>
                ä½¿ç”¨çš„å…·ä½“æœºåˆ¶æ˜¯ä»€ä¹ˆï¼Ÿ
            </h2>
            <div class="answer">
                <div class="answer-label">JSON Patch + Immutable State + React.memo</div>
                
                <h4>æœåŠ¡ç«¯ (Server-Side):</h4>
                <div class="code-block">
<span class="comment">// chat.ts - å¢é‡è¡¥ä¸ç”Ÿæˆ</span>
<span class="keyword">const</span> patch = <span class="function">compare</span>({ dsl: lastEmittedDsl }, { dsl: newDsl });
<span class="keyword">if</span> (patch.length > 0) {
    <span class="function">writeEvent</span>({
        type: EventType.<span class="string">STATE_DELTA</span>,
        delta: patch  <span class="comment">// RFC 6902 JSON Patch</span>
    });
}
                </div>

                <h4 style="margin-top: 16px;">å®¢æˆ·ç«¯ (Client-Side):</h4>
                <div class="code-block">
<span class="comment">// AGUIClient.ts - ä¸å¯å˜è¡¥ä¸åº”ç”¨</span>
<span class="keyword">private</span> <span class="function">applyImmutablePatch</span>(state: any, ops: Operation[]): any {
    <span class="keyword">let</span> nextState = state;
    <span class="keyword">for</span> (<span class="keyword">const</span> op <span class="keyword">of</span> ops) {
        nextState = <span class="keyword">this</span>.<span class="function">applyOperationImmutable</span>(nextState, pathParts, op);
    }
    <span class="keyword">return</span> nextState;  <span class="comment">// æ–°å¯¹è±¡å¼•ç”¨ï¼Œä½†æœªå˜å­æ ‘ä¿æŒåŸå¼•ç”¨</span>
}
                </div>

                <div class="code-block">
<span class="comment">// DslRenderer.tsx - Memoized ç»„ä»¶</span>
<span class="keyword">const</span> DslNode = React.<span class="function">memo</span>(({ component, data, onInteraction }) => {
    <span class="comment">// ä»…å½“ props å˜åŒ–æ—¶æ‰é‡æ–°æ‰§è¡Œ</span>
    <span class="keyword">const</span> children = component.children?.<span class="function">map</span>((child, idx) =>
        <<span class="keyword">DslNode</span> key={idx} component={child} data={data} />
    );
    <span class="keyword">return</span> WidgetMapper.<span class="function">buildWidget</span>(component, data, children);
});
                </div>
            </div>
        </div>

        <!-- Question 4 -->
        <div class="question-card" style="border-left-color: var(--warning);">
            <h2>
                <span class="question-number" style="background: var(--warning);">4</span>
                è¿™æ ·åšç¬¦åˆ A2UI åè®®è§„èŒƒå—ï¼Ÿ
            </h2>
            <div class="answer">
                <div class="answer-label" style="color: #b06000;">éƒ¨åˆ†ç¬¦åˆ</div>
                
                <table class="comparison-table">
                    <tr>
                        <th>ç‰¹æ€§</th>
                        <th>A2UI è§„èŒƒ</th>
                        <th>å½“å‰å®ç°</th>
                        <th>çŠ¶æ€</th>
                    </tr>
                    <tr>
                        <td>æ•°æ®ç»“æ„</td>
                        <td>é‚»æ¥è¡¨ (Flat with IDs)</td>
                        <td>åµŒå¥—æ ‘ (Nested Tree)</td>
                        <td><span class="badge badge-no">ä¸ç¬¦åˆ</span></td>
                    </tr>
                    <tr>
                        <td>å¢é‡æ›´æ–°</td>
                        <td>JSON Patch (RFC 6902)</td>
                        <td>JSON Patch (RFC 6902)</td>
                        <td><span class="badge badge-yes">ç¬¦åˆ</span></td>
                    </tr>
                    <tr>
                        <td>ä¼ è¾“åè®®</td>
                        <td>SSE / JSONL</td>
                        <td>SSE</td>
                        <td><span class="badge badge-yes">ç¬¦åˆ</span></td>
                    </tr>
                    <tr>
                        <td>äº‹ä»¶ç±»å‹</td>
                        <td>surfaceUpdate / dataModelUpdate</td>
                        <td>STATE_DELTA / TEXT_MESSAGE</td>
                        <td><span class="badge badge-partial">éƒ¨åˆ†</span></td>
                    </tr>
                    <tr>
                        <td>ç»„ä»¶ Schema</td>
                        <td>ä¸¥æ ¼å®šä¹‰ (Heading, Text, etc.)</td>
                        <td>è‡ªå®šä¹‰ (Card, Center, etc.)</td>
                        <td><span class="badge badge-no">ä¸ç¬¦åˆ</span></td>
                    </tr>
                    <tr>
                        <td>Surface æ¦‚å¿µ</td>
                        <td>beginRendering + surfaceId</td>
                        <td>å•ä¸€ state.dsl</td>
                        <td><span class="badge badge-no">ä¸ç¬¦åˆ</span></td>
                    </tr>
                </table>

                <h4 style="margin-top: 16px;">ä¸»è¦å·®å¼‚åˆ†æï¼š</h4>
                <ul style="margin-left: 20px; margin-top: 8px;">
                    <li><strong>é‚»æ¥è¡¨ vs åµŒå¥—æ ‘</strong>: A2UI ä½¿ç”¨æ‰å¹³åŒ–çš„é‚»æ¥è¡¨ç»“æ„ä¾¿äºå±€éƒ¨æ›´æ–°å¼•ç”¨ï¼Œæˆ‘ä»¬çš„åµŒå¥—æ ‘æ›´ç›´è§‚ä½†è¡¥ä¸è·¯å¾„æ›´æ·±ã€‚</li>
                    <li><strong>Surface ç®¡ç†</strong>: A2UI æ”¯æŒå¤š Surface ç‹¬ç«‹æ¸²æŸ“ï¼Œæˆ‘ä»¬ä½¿ç”¨å•ä¸€ DSL çŠ¶æ€ã€‚</li>
                    <li><strong>ç»„ä»¶æ ‡å‡†</strong>: A2UI æœ‰æ ‡å‡†ç»„ä»¶ç›®å½•ï¼Œæˆ‘ä»¬ä½¿ç”¨è‡ªå®šä¹‰ç»„ä»¶ï¼ˆä½†å¯æ˜ å°„ï¼‰ã€‚</li>
                </ul>
            </div>
        </div>

        <!-- Before/After Comparison -->
        <div class="question-card" style="border-left-color: var(--success);">
            <h2>
                <span class="question-number" style="background: var(--success);">5</span>
                æ”¹åŠ¨å‰åçš„æœ¬è´¨åŒºåˆ«
            </h2>
            <div class="answer">
                <div class="answer-label">æ˜¯çš„ï¼Œå®ç°äº†"æŒ‡å“ªæ‰“å“ª"çš„å¢é‡æ›´æ–°ï¼</div>
                
                <table class="comparison-table">
                    <tr>
                        <th>ç»´åº¦</th>
                        <th>æ”¹åŠ¨å‰</th>
                        <th>æ”¹åŠ¨å</th>
                    </tr>
                    <tr>
                        <td><strong>æœåŠ¡ç«¯å“åº”</strong></td>
                        <td>ç­‰å¾… LLM å®Œæ•´å“åº”åå‘é€ä¸€æ¬¡ <code>STATE_SNAPSHOT</code></td>
                        <td>æµå¼æ¥æ”¶ LLM å“åº”ï¼Œæ¯ç§¯ç´¯ä¸€æ®µå°±å‘é€ <code>STATE_DELTA</code> è¡¥ä¸</td>
                    </tr>
                    <tr>
                        <td><strong>å®¢æˆ·ç«¯çŠ¶æ€æ›´æ–°</strong></td>
                        <td><code>state.dsl = newDsl</code>ï¼ˆæ•´ä½“æ›¿æ¢ï¼‰</td>
                        <td><code>applyImmutablePatch()</code>ï¼ˆCopy-on-Writeï¼Œä»…å˜åŒ–è·¯å¾„æ–°å»ºå¯¹è±¡ï¼‰</td>
                    </tr>
                    <tr>
                        <td><strong>React æ¸²æŸ“</strong></td>
                        <td><code>renderComponent()</code> é€’å½’å‡½æ•°ï¼Œæ¯æ¬¡éå†æ•´æ£µæ ‘</td>
                        <td><code>&lt;DslNode /&gt;</code> + <code>React.memo</code>ï¼Œæœªå˜èŠ‚ç‚¹è·³è¿‡æ¸²æŸ“</td>
                    </tr>
                    <tr>
                        <td><strong>ç½‘ç»œå¸¦å®½</strong></td>
                        <td>æ¯æ¬¡å‘é€å®Œæ•´ DSL (~3KB)</td>
                        <td>æ¯æ¬¡åªå‘é€å˜åŒ–çš„è¡¥ä¸ (~100 bytes)</td>
                    </tr>
                </table>

                <h4 style="margin-top: 20px;">æ ¸å¿ƒæœºåˆ¶æµç¨‹ï¼š</h4>
                <div class="code-block" style="white-space: pre; line-height: 1.8;">
<span class="comment">æœåŠ¡ç«¯ LLM æµå¼è¾“å‡º:</span>
  "ä¸Šæµ·å¸‚"  â†’  "ä¸Šæµ·å¸‚ 8Â°C"  â†’  "ä¸Šæµ·å¸‚ 8Â°C æ™´"
       â†“              â†“               â†“
  STATE_DELTA    STATE_DELTA    STATE_DELTA
   (åªå‘å·®å¼‚)      (åªå‘å·®å¼‚)      (åªå‘å·®å¼‚)
       â†“              â†“               â†“

<span class="comment">å®¢æˆ·ç«¯ Immutable Patch:</span>
  åªæœ‰å˜åŒ–èŠ‚ç‚¹è·å¾—æ–°å¼•ç”¨ï¼Œå…¶ä»–èŠ‚ç‚¹ä¿æŒåŸå¼•ç”¨
                      â†“

<span class="comment">React.memo:</span>
  props å¼•ç”¨æœªå˜  â†’  è·³è¿‡é‡æ¸²æŸ“
  props å¼•ç”¨å˜äº†  â†’  é‡æ¸²æŸ“è¯¥èŠ‚ç‚¹
                </div>

                <div style="margin-top: 20px; padding: 16px; background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%); border-radius: 8px; text-align: center;">
                    <strong style="font-size: 1.2rem; color: var(--success);">ä¸€å¥è¯æ€»ç»“</strong>
                    <p style="margin-top: 8px; font-size: 1.1rem;">
                        <strong>æ”¹åŠ¨å‰</strong>ï¼šç­‰å®Œ â†’ å…¨æ¢ â†’ å…¨ç”»<br>
                        <strong>æ”¹åŠ¨å</strong>ï¼šè¾¹æ”¶ â†’ æ‰“è¡¥ä¸ â†’ åªç”»å˜çš„
                    </p>
                </div>
            </div>
        </div>

        <!-- Summary -->
        <div class="summary-box">
            <h3>ğŸ“‹ æ€»ç»“</h3>
            <ul>
                <li><strong>æ•°æ®ç»“æ„</strong>: ä½¿ç”¨åµŒå¥—æ ‘ ViewTreeï¼Œé A2UI é‚»æ¥è¡¨</li>
                <li><strong>æ¸²æŸ“ä¼˜åŒ–</strong>: é€šè¿‡ React.memo + Immutable Patching å®ç°å¢é‡æ¸²æŸ“ï¼Œæ— éœ€å…¨é‡é‡ç»˜</li>
                <li><strong>æ ¸å¿ƒæœºåˆ¶</strong>: æœåŠ¡ç«¯ JSON Patch å·®åˆ† + å®¢æˆ·ç«¯ Copy-on-Write åº”ç”¨</li>
                <li><strong>åè®®å…¼å®¹</strong>: éƒ¨åˆ†ç¬¦åˆ A2UIï¼ˆå¢é‡æ›´æ–°ã€SSE ä¼ è¾“ï¼‰ï¼Œä½†æ•°æ®ç»“æ„å’Œäº‹ä»¶ç±»å‹æœ‰å·®å¼‚</li>
                <li><strong>è·¯æ¼”å»ºè®®</strong>: å½“å‰å®ç°æ»¡è¶³æµå¼æ¸²æŸ“éœ€æ±‚ï¼Œå¦‚éœ€å®Œå…¨å…¼å®¹ A2UI éœ€é‡æ„ DSL ä¸ºé‚»æ¥è¡¨ç»“æ„</li>
            </ul>
        </div>

        <footer style="margin-top: 40px; text-align: center; color: var(--text-secondary); font-size: 0.9rem;">
            Generated by GenUI Streaming Implementation - 2026-01-07
        </footer>
    </div>
</body>
</html>
</CodeContent>
<parameter name="EmptyFile">false
