<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A2UI æµå¼ç”Ÿæˆä¸å±€éƒ¨æ›´æ–°æŒ‡å—</title>
    <style>
        :root {
            --primary-color: #0066cc;
            --bg-color: #f9f9f9;
            --text-color: #333;
            --code-bg: #f5f5f5;
            --card-bg: #ffffff;
            --border-color: #eaeaea;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            line-height: 1.6;
            color: var(--text-color);
            background-color: var(--bg-color);
            margin: 0;
            padding: 40px;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: var(--card-bg);
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.05);
        }
        h1 {
            border-bottom: 2px solid var(--border-color);
            padding-bottom: 20px;
            margin-bottom: 30px;
            color: #1a1a1a;
        }
        h2 {
            color: var(--primary-color);
            margin-top: 40px;
            margin-bottom: 20px;
            border-left: 4px solid var(--primary-color);
            padding-left: 12px;
        }
        h3 {
            color: #444;
            margin-top: 25px;
        }
        p {
            margin-bottom: 16px;
        }
        code {
            background-color: var(--code-bg);
            padding: 2px 6px;
            border-radius: 4px;
            font-family: SFMono-Regular, Consolas, "Liberation Mono", Menlo, monospace;
            font-size: 0.9em;
            color: #d63384;
        }
        pre {
            background-color: #2d2d2d;
            color: #f8f8f2;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 20px 0;
        }
        pre code {
            background-color: transparent;
            color: inherit;
            padding: 0;
            font-size: 0.9em;
        }
        ul, ol {
            padding-left: 24px;
            margin-bottom: 20px;
        }
        li {
            margin-bottom: 8px;
        }
        .note {
            background-color: #e6f3ff;
            border-left: 4px solid #0066cc;
            padding: 15px;
            border-radius: 0 4px 4px 0;
            margin: 20px 0;
        }
        .timeline {
            position: relative;
            padding-left: 30px;
            margin: 30px 0;
        }
        .timeline-item {
            position: relative;
            margin-bottom: 30px;
        }
        .timeline-item::before {
            content: '';
            position: absolute;
            left: -36px;
            top: 6px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--primary-color);
        }
        .timeline-item::after {
            content: '';
            position: absolute;
            left: -31px;
            top: 18px;
            bottom: -42px;
            width: 2px;
            background: #e0e0e0;
        }
        .timeline-item:last-child::after {
            display: none;
        }
        .time-badge {
            display: inline-block;
            background: #eee;
            color: #666;
            font-size: 12px;
            padding: 2px 8px;
            border-radius: 12px;
            margin-bottom: 8px;
            font-weight: bold;
        }
    </style>
</head>
<body>

<div class="container">
    <h1>A2UI æŠ€æœ¯è§£æï¼šæµå¼ç”Ÿæˆä¸å±€éƒ¨æ›´æ–°</h1>

    <p>æœ¬æ–‡æ¡£æ·±å…¥è§£æäº† A2UIï¼ˆAgentic AI User Interfaceï¼‰åè®®ä¸­çš„æµå¼ç”Ÿæˆæœºåˆ¶ï¼Œåˆ†æ React Native ç«¯çš„å®ç°åŸç†ï¼Œå¹¶æ¢è®¨å¦‚ä½•é€šè¿‡æ¶æ„ä¼˜åŒ–å®ç°é«˜æ€§èƒ½çš„å±€éƒ¨æ›´æ–°ã€‚</p>

    <h2>ä¸€ã€æµå¼ UI ç”Ÿæˆ (Streaming UI) åŸç†</h2>
    <p>A2UI çš„æ ¸å¿ƒåœ¨äºâ€œæµå¼â€ã€‚æœåŠ¡ç«¯ä¸å‘é€å®Œæ•´çš„ HTML æˆ– JSON é¡µé¢ï¼Œè€Œæ˜¯å»ºç«‹é•¿è¿æ¥ï¼ŒæŒç»­æ¨é€ç»†ç²’åº¦çš„æŒ‡ä»¤æµã€‚è¿™ç§æ¨¡å¼è®©ç•Œé¢åƒæ‰“å­—æœºä¸€æ ·â€œé•¿â€å‡ºæ¥ï¼Œæå¤§åœ°é™ä½äº†é¦–å±ç­‰å¾…æ—¶é—´ï¼Œå¢å¼ºäº† AI çš„å®æ—¶æ„Ÿã€‚</p>

    <h3>1.1 åŸºæœ¬æœºåˆ¶</h3>
    <ul>
        <li><strong>æœåŠ¡ç«¯ (Server)</strong>: é€šè¿‡ SSE (Server-Sent Events) é€šé“ï¼ŒæŒ‰é¡ºåºæ¨é€ JSONL æ ¼å¼çš„æŒ‡ä»¤ã€‚ä¸»è¦æŒ‡ä»¤åŒ…æ‹¬ï¼š
            <ul>
                <li><code>createSurface</code>: åˆ›å»ºç”»å¸ƒå®¹å™¨ã€‚</li>
                <li><code>updateComponents</code>: å¢é‡æ·»åŠ æˆ–ä¿®æ”¹ç»„ä»¶ç»“æ„ã€‚</li>
                <li><code>updateDataModel</code>: å¡«å……æˆ–æ›´æ–°æ•°æ®å­—æ®µã€‚</li>
            </ul>
        </li>
        <li><strong>å®¢æˆ·ç«¯ (Client)</strong>: 
            <ul>
                <li>ç›‘å¬ SSE æ¶ˆæ¯æµã€‚</li>
                <li>ç»´æŠ¤æœ¬åœ°çš„ <strong>ç»„ä»¶æ ‘ (Component Tree)</strong> å’Œ <strong>æ•°æ®å­˜å‚¨ (Data Store)</strong>ã€‚</li>
                <li>æ¯æ”¶åˆ°ä¸€æ¡æŒ‡ä»¤ï¼Œå®æ—¶â€œæ‰“è¡¥ä¸â€ (Patch) åˆ°æœ¬åœ°çŠ¶æ€ã€‚</li>
                <li>è§¦å‘ UI æ¡†æ¶ï¼ˆReact/Angular/Litï¼‰é‡ç»˜ã€‚</li>
            </ul>
        </li>
    </ul>

    <h3>1.2 å®ä¾‹æ¼”ç¤ºï¼šèˆªç­é¢„å®šå¡ç‰‡</h3>
    <div class="timeline">
        <div class="timeline-item">
            <span class="time-badge">0ms - åˆå§‹åŒ–</span>
            <p><strong>Server:</strong> å‘é€ <code>createSurface(id="flight_card")</code><br>
            <strong>Client:</strong> åœ¨å±å¹•èŠå¤©æµä¸­å¼€è¾Ÿä¸€å—ç©ºç™½åŒºåŸŸï¼Œæ˜¾ç¤ºåŠ è½½çŠ¶æ€ã€‚</p>
        </div>
        <div class="timeline-item">
            <span class="time-badge">100ms - ç»˜åˆ¶éª¨æ¶</span>
            <p><strong>Server:</strong> å‘é€ <code>updateComponents</code>ã€‚åŒ…å« <code>Card</code> -> <code>Column</code>ï¼Œä»¥åŠâ€œå‡ºå‘åœ°â€ã€â€œç›®çš„åœ°â€çš„æ–‡æœ¬å ä½ç¬¦ã€‚<br>
            <strong>Client:</strong> æ¸²æŸ“å‡ºå¡ç‰‡çš„çº¿æ¡†ç»“æ„ã€‚</p>
        </div>
        <div class="timeline-item">
            <span class="time-badge">300ms - å¡«å……åŸºç¡€æ•°æ®</span>
            <p><strong>Server:</strong> å‘é€ <code>updateDataModel</code>: <code>{ flightNo: "MU5183", from: "Beijing", to: "Shanghai" }</code>ã€‚<br>
            <strong>Client:</strong> é€šè¿‡æ•°æ®ç»‘å®šæœºåˆ¶ï¼Œå¡ç‰‡ä¸Šçš„æ–‡å­—ç¬é—´æ˜¾ç¤ºå†…å®¹ã€‚</p>
        </div>
        <div class="timeline-item">
            <span class="time-badge">500ms - è¡¥å……æ“ä½œåŒº</span>
            <p><strong>Server:</strong> å‘é€ <code>updateComponents</code>ã€‚åœ¨å¡ç‰‡åº•éƒ¨è¿½åŠ  <code>Row</code>ï¼ŒåŒ…å«â€œé¢„å®šâ€æŒ‰é’®ã€‚<br>
            <strong>Client:</strong> åº•éƒ¨æ“ä½œæ æ˜¾ç°ã€‚</p>
        </div>
        <div class="timeline-item">
            <span class="time-badge">800ms - åŠ¨æ€æ›´æ–°ä»·æ ¼</span>
            <p><strong>Server:</strong> åå°æŸ¥ä»·å®Œæˆï¼Œå‘é€ <code>updateDataModel</code>: <code>{ price: "Â¥1250" }</code>ã€‚<br>
            <strong>Client:</strong> ä»·æ ¼æ ‡ç­¾ä»â€œæŸ¥è¯¢ä¸­...â€å˜ä¸ºâ€œÂ¥1250â€ã€‚</p>
        </div>
    </div>

    <h3>1.3 è§†è§‰â€œç”Ÿé•¿â€æœºåˆ¶è§£æ</h3>
    <p>ç”¨æˆ·è§‚å¯Ÿåˆ°çš„â€œç¼“æ…¢é•¿å‡ºâ€æ•ˆæœï¼Œå¹¶éå‰ç«¯ç‰¹æ„åˆ¶ä½œçš„åŠ¨ç”»ï¼Œè€Œæ˜¯ <strong>A2UI åè®®æµå¼ä¼ è¾“</strong> å’Œ <strong>React å“åº”å¼æ›´æ–°</strong> å…±åŒä½œç”¨çš„è‡ªç„¶ç»“æœã€‚</p>
    
    <p><strong>æŠ€æœ¯å®ç°é“¾æ¡ï¼š</strong></p>
    <ul>
        <li><strong>æœåŠ¡ç«¯ï¼ˆæ­ç§¯æœ¨ï¼‰</strong>ï¼šæœåŠ¡ç«¯ä¸ä¼šç­‰å¾…æ•´ä¸ªå¡ç‰‡ç”Ÿæˆå®Œæ¯•æ‰å‘é€ï¼Œè€Œæ˜¯ç”Ÿæˆä¸€ä¸ªèŠ‚ç‚¹å°±å‘é€ä¸€ä¸ª Patch æŒ‡ä»¤ã€‚
            <ul>
                <li>T0: <code>op: "add", path: "/dsl", value: { type: "Card" }</code> -> å±å¹•å‡ºç°ç©ºæ¡†ã€‚</li>
                <li>T1: <code>op: "add", path: "/dsl/children/0", value: { type: "Text" }</code> -> å‡ºç°æ ‡é¢˜ï¼Œé«˜åº¦æ’‘å¼€ã€‚</li>
                <li>T2: <code>op: "add", path: "/dsl/children/1", value: { type: "Row" }</code> -> å‡ºç°è¯¦æƒ…ã€‚</li>
            </ul>
        </li>
        <li><strong>å®¢æˆ·ç«¯ï¼ˆå¿ è¯šçš„é‡ç»˜æœºå™¨ï¼‰</strong>ï¼šå®¢æˆ·ç«¯ä»£ç ä¸éœ€è¦çŸ¥é“â€œæ­£åœ¨é•¿å‡ºâ€ï¼Œå®ƒåªæ˜¯å¿ å®åœ°å“åº”çŠ¶æ€å˜åŒ–ã€‚
            <ul>
                <li>ç›‘å¬ <code>onStateUpdate</code>ã€‚</li>
                <li>æ›´æ–° React Stateã€‚</li>
                <li>React Re-render -> ç•Œé¢å…ƒç´ ä»ä¸Šåˆ°ä¸‹ã€ä¸€ä¸ªæ¥ä¸€ä¸ªåœ°å‡ºç°ã€‚</li>
            </ul>
        </li>
    </ul>
    <div class="note">
        <strong>æ€»ç»“ï¼š</strong> ä½ ä¸éœ€è¦ç¼–å†™ <code>Animated.timing</code> ç­‰åŠ¨ç”»ä»£ç ã€‚åªè¦æœåŠ¡ç«¯æµå¼è¾“å‡º Patchï¼Œå®¢æˆ·ç«¯æ­£ç¡®åˆå¹¶å¹¶ä¸åœ SetStateï¼ŒReact å°±ä¼šè‡ªåŠ¨å‘ˆç°å‡ºè¿™ç§â€œç”Ÿé•¿â€çš„è§†è§‰æ•ˆæœã€‚
    </div>

    <h2>äºŒã€React Native å®ç°ä¸ç°çŠ¶åˆ†æ</h2>

    <h3>2.1 ç°æœ‰å®ç°é€»è¾‘</h3>
    <p>åœ¨å½“å‰çš„ React Native å·¥ç¨‹ä»£ç ä¸­ï¼ˆ<code>MainScreen.tsx</code> å’Œ <code>DslRenderer.tsx</code>ï¼‰ï¼Œå¤„ç†æµç¨‹å¦‚ä¸‹ï¼š</p>
    <ol>
        <li><code>AGUIClient</code> æ”¶åˆ°è¡¥ä¸ï¼Œæ›´æ–°ä»æ ¹èŠ‚ç‚¹å¼€å§‹çš„å®Œæ•´ <code>agentState</code> å¯¹è±¡ã€‚</li>
        <li>è°ƒç”¨ <code>setAgentState(newState)</code>ï¼ŒReact çŠ¶æ€æ›´æ–°ã€‚</li>
        <li>æ ¹ç»„ä»¶ <code>MainScreen</code> è§¦å‘é‡ç»˜ã€‚</li>
        <li><code>renderComponent</code> å‡½æ•°<strong>é€’å½’éå†æ•´ä¸ª DSL JSON æ ‘</strong>ï¼Œé‡æ–°ç”Ÿæˆä¸€æ£µå®Œæ•´çš„ React Element Treeã€‚</li>
        <li><strong>React Reconciliation</strong>: React æ¡†æ¶å†…éƒ¨å¯¹æ¯”æ–°æ—§è™šæ‹Ÿ DOM æ ‘ï¼Œè®¡ç®—å·®å¼‚ï¼Œæ›´æ–°åŸç”Ÿè§†å›¾ (Native Views)ã€‚</li>
    </ol>

    <div class="note">
        <strong>ç°çŠ¶è¯„ä»·ï¼š</strong> ç›®å‰é‡‡ç”¨çš„æ˜¯â€œå…¨å±€æ•°æ®åˆ·æ–° + React Diffâ€ç­–ç•¥ã€‚
        å¯¹äºä¸­å°å‹ç•Œé¢ï¼ˆèŠ‚ç‚¹æ•° < 500ï¼‰ï¼Œè¿™ç§æ–¹å¼å¼€å‘æ•ˆç‡é«˜ï¼Œæ€§èƒ½å¯æ¥å—ä¸”ç¨³å®šã€‚ä½†å®ƒå¹¶éä¸¥æ ¼æ„ä¹‰ä¸Šçš„â€œå±€éƒ¨æ›´æ–°â€ï¼Œå› ä¸º JS å±‚çš„å…¨æ ‘éå†å¼€é”€ä¾ç„¶å­˜åœ¨ã€‚
    </div>

    <h2>ä¸‰ã€å…¨é‡ DSL ViewTree ä¸ç»†ç²’åº¦æ›´æ–°çš„æ·±åº¦å¯¹æ¯”</h2>
    <p>åœ¨ <strong>â€œå…¨é‡ DSL ViewTree é‡ç»˜â€</strong>ï¼ˆå³æœ¬é¡¹ç›®å½“å‰é‡‡ç”¨çš„æ–¹æ¡ˆï¼‰ä¸ <strong>â€œå“åº”å¼/ç»†ç²’åº¦æ›´æ–°â€</strong>ï¼ˆAngular/Lit åŠä¼˜åŒ–åçš„ React Nativeï¼‰ä¹‹é—´ï¼Œæ ¸å¿ƒåŒºåˆ«åœ¨äº <strong>â€œè°åœ¨æ‰¿æ‹…æ›´æ–°çš„è®¡ç®—æˆæœ¬â€</strong> ä»¥åŠ <strong>â€œè®¡ç®—çš„èŒƒå›´æœ‰å¤šå¤§â€</strong>ã€‚</p>

    <table border="1" style="border-collapse: collapse; width: 100%; border-color: #e0e0e0; margin-bottom: 20px;">
        <thead>
            <tr style="background-color: #f5f7fa; text-align: left;">
                <th style="padding: 12px; width: 20%;">å¯¹æ¯”ç»´åº¦</th>
                <th style="padding: 12px; width: 40%;">ğŸ”´ å…¨é‡ DSL éå† (å½“å‰æ–¹æ¡ˆ)</th>
                <th style="padding: 12px; width: 40%;">ğŸŸ¢ ç»†ç²’åº¦ / å“åº”å¼æ›´æ–° (ç†æƒ³æ–¹æ¡ˆ)</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td style="padding: 10px;"><strong>JS å±‚è¡Œä¸º</strong></td>
                <td style="padding: 10px;"><strong>â€œé‡æ–°æŠ„å†™æ•´ç¯‡æ–‡ç« â€</strong><br>æ”¶åˆ° Patch åï¼Œ<code>DslRenderer</code> ä»æ ¹èŠ‚ç‚¹å¼€å§‹ï¼Œé‡æ–°éå†æ•´ä¸ª JSON æ ‘ï¼Œä¸ºæ¯ä¸ªèŠ‚ç‚¹é‡æ–°åˆ›å»º React Element å¯¹è±¡ã€‚</td>
                <td style="padding: 10px;"><strong>â€œåªæ”¹é”™åˆ«å­—â€</strong><br>æ ¹ç»„ä»¶ä¸åŠ¨ã€‚åªæœ‰è®¢é˜…äº†å˜æ›´æ•°æ®çš„é‚£ä¸ªå¶å­ç»„ä»¶ï¼ˆå¦‚ Textï¼‰æ”¶åˆ°é€šçŸ¥å¹¶é‡ç»˜ã€‚</td>
            </tr>
            <tr>
                <td style="padding: 10px;"><strong>æ€§èƒ½å¼€é”€ (JS)</strong></td>
                <td style="padding: 10px;"><strong>é«˜ (O(N))</strong><br>N ä¸ºèŠ‚ç‚¹æ€»æ•°ã€‚éšç€ç•Œé¢å¤æ‚ï¼ˆå¦‚åµŒå¥—å¤šå±‚å¡ç‰‡ï¼‰ï¼Œå¤„ç†è€—æ—¶çº¿æ€§å¢é•¿ã€‚</td>
                <td style="padding: 10px;"><strong>ä½ (O(1) æˆ– O(M))</strong><br>M ä¸ºå—å½±å“èŠ‚ç‚¹æ•°ã€‚æ— è®ºç•Œé¢å¤šå¤æ‚ï¼Œæ”¹ä¸€ä¸ªæ•°å­—å°±æ˜¯æ”¹ä¸€ä¸ªæ•°å­—çš„è€—æ—¶ã€‚</td>
            </tr>
            <tr>
                <td style="padding: 10px;"><strong>React Reconciliation</strong></td>
                <td style="padding: 10px;"><strong>å…¨æ ‘ Diff</strong><br>React å¿…é¡»å¯¹æ¯”æ•´æ£µæ–°æ ‘ä¸æ—§æ ‘ï¼Œæ‰¾å‡ºå·®å¼‚ã€‚</td>
                <td style="padding: 10px;"><strong>å±€éƒ¨ Diff</strong><br>React åªéœ€å¯¹æ¯”å˜æ›´çš„é‚£ä¸ªç»„ä»¶åŠå…¶å­æ ‘ã€‚</td>
            </tr>
            <tr>
                <td style="padding: 10px;"><strong>å†…å­˜å‹åŠ› (GC)</strong></td>
                <td style="padding: 10px;"><strong>å¤§</strong><br>æ¯æ¬¡æ›´æ–°äº§ç”Ÿå¤§é‡ä¸´æ—¶å¯¹è±¡ï¼Œé¢‘ç¹è§¦å‘ GCï¼Œå®¹æ˜“å¯¼è‡´ UI æ‰å¸§ (Jank)ã€‚</td>
                <td style="padding: 10px;"><strong>å°</strong><br>ç»„ä»¶æ ‘ç»“æ„ç¨³å®šï¼Œåªæœ‰å˜æ›´éƒ¨åˆ†äº§ç”Ÿæ–°å¯¹è±¡ã€‚</td>
            </tr>
        </tbody>
    </table>

    <div class="note">
        <strong>æ€»ç»“ï¼š</strong> æœ¬é¡¹ç›®é‡‡ç”¨çš„æ–¹æ¡ˆæ˜¯ <strong>â€œç”¨è®¡ç®—æ¢å¼€å‘æ•ˆç‡â€</strong>ã€‚å¯¹äº Demo å’Œæ—©æœŸäº§å“ï¼Œè¿™æ˜¯å®Œå…¨æ­£ç¡®çš„é€‰æ‹©ï¼Œå› ä¸ºå®ƒä»£ç ç®€å•ã€é€»è¾‘æ¸…æ™°ã€‚åªæœ‰åœ¨å¤æ‚åœºæ™¯ï¼ˆæ•°ç™¾ä¸ªèŠ‚ç‚¹é«˜é¢‘æ›´æ–°ï¼‰ä¸‹ï¼Œæ‰éœ€è¦è€ƒè™‘å‘ç»†ç²’åº¦æ›´æ–°æ¶æ„è¿ç§»ã€‚
    </div>

    <h2>å››ã€React Native å±€éƒ¨æ›´æ–°æ”¹é€ æ–¹æ¡ˆ</h2>
    <p>è‹¥éœ€è¿½æ±‚æè‡´æ€§èƒ½ï¼ˆå¦‚é«˜é¢‘æ•°æ®è·³åŠ¨ï¼‰ï¼Œå®ç°â€œæŒ‡å“ªæ‰“å“ªâ€çš„ True Partial Updateï¼Œå»ºè®®è¿›è¡Œä»¥ä¸‹æ¶æ„é‡æ„ï¼š</p>

    <h3>4.1 æ ¸å¿ƒæ€è·¯ï¼šç»„ä»¶åŒ– + æ•°æ®è®¢é˜…éš”ç¦»</h3>
    <p>ç›®æ ‡æ˜¯é˜»æ–­ React çš„çº§è”æ›´æ–°ï¼šå½“æ ¹æ•°æ® <code>agentState</code> å˜åŒ–æ—¶ï¼Œæ ¹ç»„ä»¶ä¸åº”é‡æ–°æ¸²æŸ“ï¼Œåªæœ‰ä¾èµ–äº†å˜åŠ¨æ•°æ®çš„å¶å­ç»„ä»¶æ‰é‡æ–°æ¸²æŸ“ã€‚</p>

    <h3>4.2 æ”¹é€ æ­¥éª¤</h3>

    <h4>æ­¥éª¤ä¸€ï¼šé€’å½’å‡½æ•°ç»„ä»¶åŒ–</h4>
    <p>å°† <code>renderComponent</code> å‡½æ•°æ”¹ä¸ºè¢« <code>React.memo</code> åŒ…è£¹çš„ç»„ä»¶ã€‚è¿™æ ·åªæœ‰å½“è¯¥ç»„ä»¶çš„ DSL ç»“æ„å‘ç”Ÿå˜åŒ–æ—¶ï¼Œå®ƒæ‰ä¼šé‡ç»˜ã€‚</p>
    <pre><code>// æ”¹é€ å‰ï¼šå‡½æ•°é€’å½’è°ƒç”¨ï¼ˆæ¯æ¬¡çˆ¶ç»„ä»¶åˆ·æ–°éƒ½ä¼šæ‰§è¡Œï¼‰
const renderComponent = (dsl, data) => { ... }

// æ”¹é€ åï¼šMemo ç»„ä»¶é€’å½’
const GenUIComponent = React.memo(({ dsl }) => {
    // æ¸²æŸ“é€»è¾‘...
    return &lt;View&gt;{children.map(c => &lt;GenUIComponent dsl={c} key={c.id} /&gt;)}&lt;/View&gt;
}, (prev, next) => {
    // è‡ªå®šä¹‰æ¯”è¾ƒé€»è¾‘ï¼šä»…å½“ DSL ç»“æ„å˜åŠ¨æ—¶æ‰è¿”å› false (è§¦å‘é‡ç»˜)
    return prev.dsl === next.dsl;
});</code></pre>

    <h4>æ­¥éª¤äºŒï¼šå¼•å…¥æŒ‰éœ€æ•°æ®è®¢é˜… (Fine-Grained Subscription)</h4>
    <p>æœ€å¤§çš„ç—›ç‚¹æ˜¯ <code>dataContext</code> çš„ä¼ é€’ã€‚å¦‚æœé€šè¿‡ Props ä¼ é€’å¤§å¯¹è±¡ï¼ŒMemo å°±ä¼šå¤±æ•ˆã€‚è§£å†³æ–¹æ¡ˆæ˜¯ä¸ä¼ æ•°æ®ï¼Œä¼  "Data Store" çš„å¼•ç”¨ï¼Œç»„ä»¶å†…éƒ¨è‡ªå·±å»â€œæ‘˜â€æ•°æ®ã€‚</p>

    <p><strong>æ–¹æ¡ˆæ¨èï¼šContext + Selector æ¨¡å¼</strong></p>
    <pre><code>// 1. åˆ›å»ºæ•°æ®ä»“åº“ Context
const DataStoreContext = React.createContext(null);

// 2. å°è£… Hookï¼šåªè®¢é˜…ç‰¹å®šçš„ path
const useDataBinding = (path) => {
    const store = useContext(DataStoreContext);
    // æ ¸å¿ƒï¼šä½¿ç”¨ useSyncExternalStore æˆ–ç±»ä¼¼åº“æ¥å®ç°é€‰æ‹©æ€§è®¢é˜…
    // åªæœ‰å½“ store.get(path) çš„å€¼å‘ç”Ÿå˜åŒ–æ—¶ï¼Œå½“å‰ç»„ä»¶æ‰ä¼šé‡ç»˜
    return useStoreSelector(store, (state) => get(state, path)); 
};

// 3. å¶å­ç»„ä»¶å®ç°
const A2UIText = ({ dsl }) => {
    // åªæœ‰ user.name å˜åŒ–æ—¶ï¼Œè¿™ä¸ª Text ç»„ä»¶æ‰ä¼šé‡ç»˜
    // å“ªæ€• agentState å…¶ä»–éƒ¨åˆ†ç¿»å¤©è¦†åœ°ï¼Œè¿™é‡Œä¹Ÿä¸ä¼šåŠ¨
    const text = useDataBinding(dsl.properties.text_binding); 
    return &lt;Text&gt;{text}&lt;/Text&gt;;
}</code></pre>

    <h3>4.3 å…¶ä»–æ¡†æ¶å‚è€ƒ</h3>
    <p>ç°æœ‰çš„ <strong>Angular</strong> å’Œ <strong>Lit</strong> å‚è€ƒå®ç°å‡å·²æ”¯æŒæµå¼ç”Ÿæˆã€‚å®ƒä»¬åˆ©ç”¨å„è‡ªæ¡†æ¶çš„ç‰¹æ€§ï¼ˆAngular çš„ Signals/Observablesï¼ŒLit çš„ Reactive Propertiesï¼‰å¤©ç„¶åœ°å®ç°äº†ç±»ä¼¼çš„ç»†ç²’åº¦æ›´æ–°æœºåˆ¶ã€‚</p>

    <h2>äº”ã€ä¸»æµæ¡†æ¶å®ç°æ–¹æ¡ˆå¯¹æ¯”</h2>
    <p>A2UI çš„å‚è€ƒå®ç°è¦†ç›–äº† Angularã€Lit å’Œ React Nativeã€‚è™½ç„¶æµå¼ç”Ÿæˆçš„åŸç†ä¸€è‡´ï¼Œä½†ä¸åŒæ¡†æ¶çš„åº•å±‚å“åº”æœºåˆ¶å†³å®šäº†å®ç°è·¯å¾„çš„å·®å¼‚ã€‚</p>

    <table border="1" style="border-collapse: collapse; width: 100%; border-color: #e0e0e0; margin-bottom: 30px;">
        <thead>
            <tr style="background-color: #f5f7fa; text-align: left;">
                <th style="padding: 12px; width: 20%;">ç‰¹æ€§</th>
                <th style="padding: 12px; width: 26%;">React Native (å½“å‰å®ç°)</th>
                <th style="padding: 12px; width: 27%;">Angular (A2UI å‚è€ƒå®ç°)</th>
                <th style="padding: 12px; width: 27%;">Lit (Web Components)</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td style="padding: 10px;"><strong>æ ¸å¿ƒå“åº”æœºåˆ¶</strong></td>
                <td style="padding: 10px;"><strong>State + Virtual DOM Reconciliation</strong><br><span style="color: #666; font-size: 0.9em;">å…¨å±€çŠ¶æ€æ›´æ–° -> è§¦å‘æ ¹ç»„ä»¶é‡ç»˜ -> Diff æ–°æ—§æ ‘ -> Native æ›´æ–°ã€‚</span></td>
                <td style="padding: 10px;"><strong>Signals (ä¿¡å·)</strong><br><span style="color: #666; font-size: 0.9em;">ä½¿ç”¨ Angular Signals (<code>effect</code>, <code>input</code>) ç²¾ç¡®è¿½è¸ªä¾èµ–ï¼Œå®ç°æ—  Zone.js çš„ç»†ç²’åº¦æ›´æ–°ã€‚</span></td>
                <td style="padding: 10px;"><strong>Reactive Properties</strong><br><span style="color: #666; font-size: 0.9em;">åŸºäºæ ‡å‡† Web Components ç”Ÿå‘½å‘¨æœŸã€‚å±æ€§å˜åŒ–è§¦å‘ <code>update()</code> -> ä»…é‡ç»˜ Shadow DOMã€‚</span></td>
            </tr>
            <tr>
                <td style="padding: 10px;"><strong>æ•°æ®ç»‘å®šæ–¹å¼</strong></td>
                <td style="padding: 10px;"><strong>Props é€å±‚é€ä¼ </strong><br><span style="color: #666; font-size: 0.9em;">éœ€è¦æ‰‹åŠ¨å®ç° <code>useContext</code> ä¼˜åŒ–æ‰èƒ½é¿å…æ— æ•ˆæ¸²æŸ“ã€‚</span></td>
                <td style="padding: 10px;"><strong>Input Bindings</strong><br><span style="color: #666; font-size: 0.9em;">é€šè¿‡ <code>inputBinding</code> å°†æ•°æ®æµç›´æ¥æ˜ å°„ä¸ºç»„ä»¶è¾“å…¥ï¼Œæ¡†æ¶è‡ªåŠ¨ç®¡ç†å˜æ›´æ£€æµ‹ã€‚</span></td>
                <td style="padding: 10px;"><strong>HTML Attribute/Property</strong><br><span style="color: #666; font-size: 0.9em;">æ•°æ®ä½œä¸º Property ä¼ é€’ï¼Œé«˜æ•ˆæ›´æ–° DOM èŠ‚ç‚¹ã€‚</span></td>
            </tr>
            <tr>
                <td style="padding: 10px;"><strong>åŠ¨æ€ç»„ä»¶åŠ è½½</strong></td>
                <td style="padding: 10px;"><strong>é€’å½’æ¸²æŸ“å‡½æ•°</strong><br><span style="color: #666; font-size: 0.9em;"><code>WidgetMapper</code> ç®€å•æš´åŠ›ï¼Œé€‚åˆåŠ¨æ€æ€§æå¼ºçš„ DSLã€‚</span></td>
                <td style="padding: 10px;"><strong>ViewContainerRef</strong><br><span style="color: #666; font-size: 0.9em;">ä½¿ç”¨ <code>viewContainerRef.createComponent</code> åŠ¨æ€æŒ‚è½½ç¼–è¯‘å¥½çš„ Angular ç»„ä»¶ã€‚</span></td>
                <td style="padding: 10px;"><strong>Template Composition</strong><br><span style="color: #666; font-size: 0.9em;">åˆ©ç”¨ <code>html</code> æ¨¡æ¿å­—é¢é‡èƒ½åŠ›ï¼ŒåŠ¨æ€ç»„åˆ Web Components æ ‡ç­¾ã€‚</span></td>
            </tr>
            <tr>
                <td style="padding: 10px;"><strong>æµå¼è§†è§‰æ•ˆæœ</strong></td>
                <td style="padding: 10px;"><strong>è‡ªç„¶å‘ˆç°</strong><br><span style="color: #666; font-size: 0.9em;">ä¾èµ–é«˜é¢‘ State åˆ·æ–°ï¼Œè§†è§‰ä¸Šè¿ç»­ã€‚</span></td>
                <td style="padding: 10px;"><strong>ç¨³å®šå¹³æ»‘</strong><br><span style="color: #666; font-size: 0.9em;">Signals æœºåˆ¶ä¿è¯äº†åªæœ‰å˜åŒ–çš„éƒ¨åˆ†æ‰ä¼šè§¦å‘å¸ƒå±€è®¡ç®—ï¼ŒæŠ–åŠ¨æ›´å°‘ã€‚</span></td>
                <td style="padding: 10px;"><strong>æé€Ÿå“åº”</strong><br><span style="color: #666; font-size: 0.9em;">æµè§ˆå™¨åŸç”Ÿçº§æ›´æ–°ï¼Œå¼€é”€æœ€å°ã€‚</span></td>
            </tr>
        </tbody>
    </table>

    <div class="note">
        <strong>æŠ€æœ¯é€‰å‹å»ºè®®ï¼š</strong><br>
        å¦‚æœæ‚¨æ­£åœ¨é‡æ„ React Native ç«¯ï¼Œå»ºè®®å€Ÿé‰´ Angular å‚è€ƒå®ç°çš„ <strong>Signals</strong> æ€æƒ³ã€‚è™½ç„¶ React è‡ªèº«æ²¡æœ‰ Signalsï¼ˆPreact æœ‰ï¼‰ï¼Œä½†å¯ä»¥é€šè¿‡ <strong>Recoil</strong>, <strong>Jotai</strong> æˆ– <strong>Context Selector</strong> æ¥æ¨¡æ‹Ÿè¿™ç§â€œç²¾å‡†æ‰“å‡»â€çš„æ›´æ–°æ¨¡å¼ï¼Œä»è€Œåœ¨å®ç°æµå¼ç”Ÿæˆæ—¶è·å¾—æ¥è¿‘ Angular/Lit çš„æ€§èƒ½è¡¨ç°ã€‚
    </div>
</div>

</body>
</html>
