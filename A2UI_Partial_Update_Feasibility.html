<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A2UI æµå¼ç”Ÿé•¿ä¸å±€éƒ¨æ›´æ–°å…¨æ™¯æ–¹æ¡ˆ</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <style>
        :root {
            --primary-color: #2c3e50;
            --accent-color: #2980b9;
            --server-color: #d35400;
            --client-color: #27ae60;
            --bg-color: #f9f9f9;
            --text-color: #2c3e50;
            --card-bg: #ffffff;
            --code-bg: #f5f6fa;
            --verify-color: #8e44ad;
            --perf-color: #e74c3c;
            --effect-color: #16a085;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            line-height: 1.6;
            color: var(--text-color);
            background-color: var(--bg-color);
            margin: 0;
            padding: 40px;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: var(--card-bg);
            padding: 50px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        }
        h1 {
            color: var(--primary-color);
            border-bottom: 3px solid #eee;
            padding-bottom: 25px;
            text-align: center;
        }
        h2 {
            margin-top: 60px;
            border-left: 5px solid;
            padding-left: 15px;
            font-size: 1.8em;
        }
        .h2-effect { color: var(--effect-color); border-left-color: var(--effect-color); }
        .h2-verify { color: var(--verify-color); border-left-color: var(--verify-color); }
        .h2-arch { color: var(--primary-color); border-left-color: var(--primary-color); }
        .h2-server { color: var(--server-color); border-left-color: var(--server-color); }
        .h2-client { color: var(--client-color); border-left-color: var(--client-color); }
        .h2-perf { color: var(--perf-color); border-left-color: var(--perf-color); }
        .h2-roadmap { color: var(--accent-color); border-left-color: var(--accent-color); }

        h3 { color: #555; margin-top: 35px; font-weight: 600; }
        p, li { font-size: 16px; }
        ul { padding-left: 20px; }
        li { margin-bottom: 8px; }
        
        code {
            background-color: var(--code-bg);
            padding: 2px 6px;
            border-radius: 4px;
            font-family: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, monospace;
            color: #c0392b;
            font-size: 0.9em;
        }
        pre {
            background-color: #2d2d2d;
            color: #f8f8f2;
            padding: 15px;
            border-radius: 6px;
            overflow-x: auto;
            font-family: Menlo, monospace;
            font-size: 0.9em;
        }
        .box {
            background-color: #eef7fa;
            border-left: 5px solid var(--accent-color);
            padding: 20px;
            margin: 25px 0;
            border-radius: 0 6px 6px 0;
        }
        .text-box {
            background-color: #f8f9fa;
            border: 1px solid #e9ecef;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }
        .mermaid {
            background: white;
            padding: 20px;
            border: 1px solid #e1e1e1;
            border-radius: 8px;
            margin: 30px 0;
            text-align: center;
        }
    </style>
</head>
<body>

<div class="container">
    <h1>A2UI æµå¼ç”Ÿé•¿ä¸å±€éƒ¨æ›´æ–°å…¨æ™¯æ–¹æ¡ˆ</h1>
    
    <div class="box">
        <strong>æ ¸å¿ƒç›®æ ‡ï¼š</strong> æŠ›å¼ƒå®˜æ–¹ Sample çš„å…¨é‡é‡ç»˜æ¨¡å¼ï¼Œæ„å»ºä»æœåŠ¡ç«¯ Token åˆ°å®¢æˆ·ç«¯ Pixel çš„å…¨é“¾è·¯å®æ—¶ç®¡çº¿ã€‚
        <br><strong>ç»ˆæä½“éªŒï¼š</strong> å®ç°ç±»ä¼¼ ChatGPT çš„æ‰“å­—æœºå¼è§†è§‰ç”Ÿé•¿ï¼Œå¹¶ç¡®ä¿ 60FPS ä¸æ»‘æµç•…ã€‚
    </div>

    <!-- 1. é¢„æœŸæ•ˆæœè§£æ (Visual Outcome) -->
    <h2 class="h2-effect">ä¸€ã€é¢„æœŸæ•ˆæœï¼šç”Ÿé•¿ä¸ä¸æ»‘çš„åŒºåˆ«</h2>
    <p>ä¸ºäº†æ˜ç¡®â€œæ”¹é€ åèƒ½çœ‹åˆ°ä»€ä¹ˆâ€ï¼Œæˆ‘ä»¬æŠŠè§†è§‰ä½“éªŒæ‹†è§£ä¸ºä¸¤ä¸ªç»´åº¦ï¼š</p>
    
    <div class="text-box">
        <h3>1. è§†è§‰å¼•æ“ (Phase 1 & 2) -> è´Ÿè´£â€œç”Ÿé•¿â€</h3>
        <ul>
            <li><strong>ä½œç”¨</strong>ï¼šè¿™æ˜¯è®©å¡ç‰‡â€œæ…¢æ…¢é•¿å‡ºæ¥â€çš„å…³é”®ã€‚</li>
            <li><strong>æ— æ­¤æ¨¡å—</strong>ï¼šç•Œé¢ä¼š Loading å¾ˆä¹…ï¼Œç„¶åæ‰€æœ‰å†…å®¹â€œå•ªâ€åœ°ä¸€ä¸‹åŒæ—¶å‡ºç°ï¼ˆPop-inï¼‰ã€‚</li>
            <li><strong>æœ‰æ­¤æ¨¡å—</strong>ï¼šUI è¿™é‡Œè¹¦å‡ºä¸€ä¸ªæ¡†ï¼Œé‚£é‡Œè¹¦å‡ºä¸€è¡Œå­—ã€‚è§†è§‰ä¸Šå°±æ˜¯ï¼šç©ºå¡ç‰‡ -> ç¬¬ä¸€è¡Œå­— -> å›¾ç‰‡ -> æŒ‰é’®ã€‚è¿™å°±æ˜¯æ‚¨è¦çš„â€œç”Ÿé•¿æ„Ÿâ€ã€‚</li>
        </ul>
    </div>

    <div class="text-box">
        <h3>2. æµç•…åº¦å¼•æ“ (Phase 3) -> è´Ÿè´£â€œä¸æ»‘â€</h3>
        <ul>
            <li><strong>ä½œç”¨</strong>ï¼šè¿™æ˜¯è®©ç”Ÿé•¿è¿‡ç¨‹ä¸å¡é¡¿ã€æ‰‹æœºä¸å‘çƒ«çš„å…³é”®ã€‚</li>
            <li><strong>æ— æ­¤æ¨¡å—</strong>ï¼šå½“æ–‡å­—å¾ˆé•¿æ—¶ï¼Œç”Ÿé•¿è¿‡ç¨‹ä¼šåƒå¹»ç¯ç‰‡ä¸€æ ·å¡é¡¿ (Jank)ï¼Œå› ä¸ºæ¯é•¿ä¸€ä¸ªå­—ï¼Œæ•´ä¸ªé¡µé¢éƒ½åœ¨é‡ç»˜ã€‚</li>
            <li><strong>æœ‰æ­¤æ¨¡å—</strong>ï¼šåªæœ‰æ­£åœ¨æ‰“å­—çš„é‚£ä¸ªå…‰æ ‡å¤„åœ¨é—ªçƒï¼Œå‘¨å›´ç•Œé¢é™æ­¢ä¸åŠ¨ã€‚è¿™å°±æ˜¯ 60FPS çš„â€œä¸æ»‘æ„Ÿâ€ã€‚</li>
        </ul>
    </div>

    <!-- 2. åè®®åˆè§„æ€§éªŒè¯ (Protocol Compliance) -->
    <h2 class="h2-verify">äºŒã€åè®®åˆè§„æ€§éªŒè¯ (Protocol Check)</h2>
    <p>æˆ‘ä»¬çš„æ–¹æ¡ˆä¸ä»…ç¬¦åˆåè®®ï¼Œè€Œä¸”æ¯”å®˜æ–¹ Sample æ›´â€œæ­£ç»Ÿâ€ã€‚</p>
    <ul>
        <li><strong>åè®®åŸæ–‡</strong>ï¼š"Communication occurs via a JSON Lines (JSONL) stream... enabling progressive rendering."</li>
        <li><strong>ç»“è®º</strong>ï¼šA2UI åè®®å¤©ç”Ÿå°±æ˜¯ä¸ºæµå¼è®¾è®¡çš„ã€‚å®˜æ–¹ Sample ä¸ºäº†å·¥ç¨‹ä¾¿åˆ©ç‰ºç‰²äº†è¿™ä¸€ç‚¹ï¼Œè€Œæˆ‘ä»¬æ­£åœ¨é€šè¿‡è‡ªç ”ç®¡çº¿å°†å…¶æ‰¾å›æ¥ã€‚</li>
    </ul>

    <!-- 3. å…¨é“¾è·¯æ¶æ„ (Architecture) -->
    <h2 class="h2-arch">ä¸‰ã€å…¨é“¾è·¯æŠ€æœ¯æ¶æ„ (Architecture)</h2>
    <div class="mermaid">
    sequenceDiagram
        participant User
        participant Client as ğŸŸ¢ RN Client
        participant Server as ğŸŸ  Server
        participant LLM as ğŸ¤– LLM

        User->>Client: "æŸ¥è¯¢é”€é‡"
        Client->>Server: HTTP POST (stream=true)
        Server->>LLM: Chat Stream
        
        loop Token Stream
            LLM->>Server: Chunk: '{ "type":'
            Note right of Server: Real-time Parsing & Diffing
            Server-->>Client: SSE Event: op="add", path="/type"
            Note left of Client: Partial Mutation
            Client-->>User: (UI éª¨æ¶é€è¡Œæ˜¾ç°)
        end
    </div>

    <h3 style="color:var(--server-color)">1. äº‘ä¾§ï¼šæµå¼ Diff å¼•æ“</h3>
    <ul>
        <li><strong>Best-Effort Parser</strong>: å®æ—¶ä¿®å¤ LLM åå‡ºçš„æ®‹ç¼º JSON (å¦‚ <code>{"list": [1, 2</code>)ã€‚</li>
        <li><strong>Diff Engine</strong>: é€å¸§å¯¹æ¯”ï¼Œç”Ÿæˆæœ€å° Patchï¼Œè€Œéå…¨é‡æ•°æ®ã€‚</li>
    </ul>

    <h3 style="color:var(--client-color)">2. ç«¯ä¾§ï¼šå±€éƒ¨æ¸²æŸ“å™¨</h3>
    <ul>
        <li><strong>Patch Applier</strong>: æ¥æ”¶ Patchï¼ŒåŸåœ°ä¿®æ”¹ Storeã€‚</li>
        <li><strong>Scope</strong>: ç¡®ä¿å˜æ›´åªå½±å“ Global Storeï¼Œä¸è§¦å‘ React æ ¹ç»„ä»¶é‡ç»˜ã€‚</li>
    </ul>

    <!-- 4. Phase 3 æ·±åº¦è§£æ (Deep Dive) -->
    <h2 class="h2-perf">å››ã€æ·±åº¦è§£æï¼šPhase 3 æè‡´æ€§èƒ½ä¼˜åŒ–</h2>
    <p>å¦‚ä½•åšåˆ°â€œç‰µä¸€å‘è€Œ<strong>ä¸</strong>åŠ¨å…¨èº«â€ï¼Ÿ</p>

    <div class="mermaid">
    graph TD
        subgraph Old ["âŒ ä¼˜åŒ–å‰ (Cascading Update)"]
            A[Root] -->|ä¼ æ•´ä¸ªObj| B[List]
            B -->|ä¼ Item| C[Item]
            C -->|ä¼ Text| D[Text]
            style D fill:#ffcccc
            Update["æ›´æ–°å¶å­"] --> A
            A -->|é‡ç»˜| B -->|é‡ç»˜| C -->|é‡ç»˜| D
        end

        subgraph New ["âœ… ä¼˜åŒ–å (Context Selector)"]
            Store{Global Store}
            RI[Item] 
            RT[Text]
            
            Store -.->|"Hook: select(path)"| RT
            style RT fill:#a8e6cf
            
            Update2["æ›´æ–°å¶å­"] --> Store
            Store -->|è·³è¿‡Root/List| RT
        end
    </div>

    <h3>Magic Code: ä»ä¼ å€¼åˆ°ä¼ å€</h3>
    <pre><code class="language-tsx">// âŒ Old: çˆ¶ç»„ä»¶ä¼ å€¼ï¼Œçˆ¶ç»„ä»¶ä¸€å˜ï¼Œå­ç»„ä»¶å¿…å˜
<TextComponent value={data.text} />

// âœ… New: çˆ¶ç»„ä»¶ä¼ è·¯å¾„(Path)ï¼Œè·¯å¾„æ°¸è¿œä¸å˜
// å­ç»„ä»¶è‡ªå·±å»ä»“åº“(Store)é‡Œå·æ•°æ®
<SmartTextComponent path="/children/0/props/text" /></code></pre>

    <!-- 5. è·¯çº¿å›¾ (Roadmap) -->
    <h2 class="h2-roadmap">äº”ã€å®æ–½è·¯çº¿å›¾ (Roadmap)</h2>

    <h3>Phase 1: å®¢æˆ·ç«¯â€œæ˜¾å¼æµå¼â€æ”¹é€  (Visible Streaming)</h3>
    <p><strong>åŠ¨ä½œ</strong>ï¼šä¿®æ”¹ <code>MainScreen.tsx</code>ï¼Œç§»é™¤ç­‰å¾…é€»è¾‘ï¼Œå…è®¸æ¸²æŸ“ä¸­é—´æ€ DSLã€‚<br>
    <strong>ä»·å€¼</strong>ï¼šæ‰“é€šè¡€ç®¡ã€‚ä¸€æ—¦æœåŠ¡ç«¯å¼€å§‹æµå¼ä¼ è¾“ï¼Œè§†è§‰æ•ˆæœç«‹å³ç”Ÿæ•ˆã€‚</p>

    <h3>Phase 2: æœåŠ¡ç«¯ Diff å¼•æ“æ”¹é€ </h3>
    <p><strong>åŠ¨ä½œ</strong>ï¼šå¼•å…¥ <code>json-repair</code> å’Œ <code>Streaming Parser</code>ã€‚<br>
    <strong>ä»·å€¼</strong>ï¼šçœŸæ­£çš„æ•°æ®æºå¤´æ´»æ°´ã€‚å®ç°â€œç”Ÿé•¿â€æ•ˆæœçš„æ ¸å¿ƒã€‚</p>
    
    <h3>Phase 3: å®¢æˆ·ç«¯æè‡´æ€§èƒ½ä¼˜åŒ–</h3>
    <p><strong>åŠ¨ä½œ</strong>ï¼šé‡æ„ <code>DslRenderer</code>ï¼Œå¼•å…¥ <code>React.memo</code> å’Œ <code>Selectors</code>ã€‚<br>
    <strong>ä»·å€¼</strong>ï¼šå°† 30FPS çš„å¡é¡¿ç”Ÿé•¿å‡çº§ä¸º 60FPS çš„ä¸æ»‘ç”Ÿé•¿ã€‚</p>

    <script>
        mermaid.initialize({ startOnLoad: true });
    </script>
</div>

</body>
</html>
